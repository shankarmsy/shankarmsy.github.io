<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Data Munging with Pandas (Advanced) | Shankar's Data Science Blog</title>

                <link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

      <link rel="canonical" href="https://shankarmsy.github.io/posts/munging-pandas.html">




    
        <!--[if lt IE 9]><script src="../assets/js/html5.js"></script><![endif]-->

    
   

    
    <meta name="author" content="Shankar Muthuswamy">
        <meta property="og:site_name" content="Shankar's Data Science Blog">
    <meta property="og:title" content="Data Munging with Pandas (Advanced)">
    <meta property="og:url" content="https://shankarmsy.github.io/posts/munging-pandas.html">
    <meta property="og:description" content="Pandas is a Python library for doing data analysis. It's really fast and lets you do exploratory work incredibly quickly.
In this post I will demonstrate some advanced data munging/wrangling concepts ">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2014-11-17T02:03:44-08:00">
           <meta property="article:tag" content="data munging">
           <meta property="article:tag" content="pandas">
           <meta property="article:tag" content="python">
           <meta property="article:tag" content="scikit-learn">

    
    

</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://shankarmsy.github.io/">

                <span id="blog-title">Shankar's Data Science Blog</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                                <li>
<a href="../archive.html">Archive</a>
                </li>
<li>
<a href="../categories/index.html">Tags</a>
                </li>
<li>
<a href="../stories/projects.html">Projects</a>
            </li>
<li class="dropdown">
<a href="#" class="dropdown-toggle" data-toggle="dropdown">About<b class="caret"></b></a>
            <ul class="dropdown-menu">
                    <li>
<a href="../stories/intro.html">Goal of the Blog</a>
                    </li>
<li>
<a href="why-data-scientist.html">Why Data Science</a>
            </li>
</ul>

                
            </li>
</ul>
                <a href="https://github.com/shankarmsy" style="position:relative; left:270px; top: 10px">
<img title="Github" alt="Github" src="../assets/Octocat.png" width="28" height="28">
</a>
<a href="https://twitter.com/shankarmsy" style="position:relative; left:270px; top: 10px">
<img title="Twitter" alt="Twitter" src="../assets/twitter.png" width="28" height="28">
</a>
<a href="https://linkedin.com/in/shankarmsy" style="position:relative; left:270px; top: 10px">
<img title="LinkedIn" alt="LinkedIn" src="../assets/linkedin.png" width="28" height="28">
</a>
<a href="../rss.xml" style="position:relative; left:270px; top: 10px">
<img title="RSS" alt="RSS" src="../assets/rss.png" width="28" height="28"> </a>


            <ul class="nav navbar-nav navbar-right">
     <!-- <div id="social"> -->
   <!-- <a href="/posts/munging-pandas.ipynb" id="sourcelink">Source</a> -->
<!-- <a href="https://github.com/shankarmsy" style = "position:absolute; right:320px; top: 16px;"> 
<img title="Github" alt="Github" src="/assets/Octocat.png" width="28" height="28"/> 
</a> 
<a href="https://twitter.com/shankarmsy" style = "position:absolute; right:290px; top: 16px;"> 
<img title="Twitter" alt="Twitter" src="/assets/twitter.png" width="28" height="28" /> 
</a> 
<a href="https://linkedin.com/in/shankarmsy" style = "position:absolute; right:255px; top: 16px;"> 
<img title="LinkedIn" alt="LinkedIn" src="/assets/linkedin.png" width="28" height="28" /> 
</a> 
<a href="/rss.xml" style = "position:absolute; right:225px; top: 16px;"> 
<img title="RSS" alt="RSS" src="/assets/rss.png" width="28" height="28" /> </a> -->
<!-- </a></div> -->
                
            </ul>
        </div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav>

<!-- End of Menubar -->

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article">
        <header>
            <h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Data Munging with Pandas (Advanced)</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">Shankar Muthuswamy</span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2014-11-17T02:03:44-08:00" itemprop="datePublished" title="2014-11-17 02:03">2014-11-17 02:03</time></a></p>
                <p class="commentline">            <a href="munging-pandas.html#disqus_thread" data-disqus-identifier="cache/posts/munging-pandas.html">Comments</a>


                    </p>
<p class="sourceline"><a href="munging-pandas.ipynb" id="sourcelink">Source</a></p>

        </div>
        
    </header>

    <div class="e-content entry-content" itemprop="articleBody text">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pandas is a Python library for doing data analysis. It's really fast and lets you do exploratory work incredibly quickly.</p>
<p>In this post I will demonstrate some advanced data munging/wrangling concepts with the awesome Pandas. I intend to code more and write less but will add help text as much as possible. Check out the pandas help documentation to learn more.</p>
<p>OK, let's get started. <!-- TEASER_END --></p>
<p>For basics of Pandas, refer to my earlier post <a href="dive-in-to-pandas.html">Dive-in to Pandas</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [11]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Importing required Python packages</span>
<span class="o">%</span><span class="k">matplotlib</span> <span class="n">inline</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">StringIO</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">seaborn</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">ord</span><span class="p">,</span> <span class="s">"aesthetics"</span><span class="p">)))</span>
<span class="n">seaborn</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s">'notebook'</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.mpl_style'</span><span class="p">,</span> <span class="s">'default'</span><span class="p">)</span> <span class="c"># Make the graphs a bit prettier</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">'figure.figsize'</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span> 

<span class="c"># Set some Pandas options</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.notebook_repr_html'</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_columns'</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s">'display.max_rows'</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [8]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Let's read in a sample crime database from Sacramento for our analysis.</span>
<span class="n">crime</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'SacramentocrimeJanuary2006.csv'</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="s">'True'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s">'cdatetime'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [10]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">crime</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[10]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                         address  district        beat  grid  \
cdatetime                                                      
1/1/06 0:00   3108 OCCIDENTAL DR         3  3C          1115   
1/1/06 0:00  2082 EXPEDITION WAY         5  5A          1512   
1/1/06 0:00           4 PALEN CT         2  2A           212   
1/1/06 0:00       22 BECKFORD CT         6  6C          1443   
1/1/06 0:00     3421 AUBURN BLVD         2  2A           508   

                                crimedescr  ucr_ncic_code   latitude  \
cdatetime                                                              
1/1/06 0:00  10851(A)VC TAKE VEH W/O OWNER           2404  38.550420   
1/1/06 0:00     459 PC  BURGLARY RESIDENCE           2204  38.473501   
1/1/06 0:00  10851(A)VC TAKE VEH W/O OWNER           2404  38.657846   
1/1/06 0:00   476 PC PASS FICTICIOUS CHECK           2501  38.506774   
1/1/06 0:00   459 PC  BURGLARY-UNSPECIFIED           2299  38.637448   

              longitude  
cdatetime                
1/1/06 0:00 -121.391416  
1/1/06 0:00 -121.490186  
1/1/06 0:00 -121.462101  
1/1/06 0:00 -121.426951  
1/1/06 0:00 -121.384613  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [15]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Quick Histogram of crimes in different districts.</span>
<span class="n">crime</span><span class="o">.</span><span class="n">district</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0ARwN2Op00m83UarXUarUMDw+n3W5vOu90Onf/XgAAAOwRWz4Tt5V33nknzzzzTJJkZWUl9Xo9s7Oz%0ASZJ6vZ7l5eWN2x+fN5vNT7c1AADAHrWjiHv33Xfz0EMP5eGHH06SDA4OZnV1NRMTE+l2u5mZmcm+%0AfftSVdWm860MDQ3tZCX47F1e6/UGtzVw34Dvob2ogLOZOJ97lcec3cz53FsGCvn/5Z24bcR1u92b%0APv7ggw9y7ty5PPfccxuzRqORdru98XGn00mj0UhVVZvOt7K4uHjHywM3u75+3fcQu5bzufcMDQ15%0AzNm1nM+95/r69V6vcNdsGXGnT5/O2bNns7S0lLW1tZw4cSI//elPs3///rz88sv52te+lueffz79%0A/f05evRopqamkiRjY2NJ8olzAAAAdmbLiDt8+HAOHz580+zkyZObXjs6OprR0dE7ngMAALB93uwb%0AAACgICIOAACgIDt+iwEAgK180FnMv3603Os1bmv4S7U0vnR/r9cAuGMiDgD4THx4ZS0/+vkver3G%0Abf35M98QcXuQHzJQMhEHAMCe44cMlMzvxAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEA%0AABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRE%0AxAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRExAEAABRkYKtPnj9/PqdOncqBAwdy%0A/PjxJMnCwkLm5+eTJOPj42m1WjuaAwAAsH1bRtz6+nqOHDmSixcvJkmqqsrc3FwmJyeTJNPT02m1%0AWtuaj4yMpK+v77O8TwAAAJ9bW0bcwYMHc+7cuY2PO51Oms1marVakmR4eDjtdjvdbveO5//53wAA%0AAGD7toy4j1tZWUm9Xs/s7GySpF6vZ3l5eeP2nc63irihoaFt3gW4Ry6v9XqD2xq4b8D30F5UwNlM%0AnM89ydlkN3M+95yBQh7zO7GtiBscHMzq6momJibS7XYzMzOTffv2paqqbc23sri4+KnuEOxl19ev%0A+x5i13I+2a2cTXYz5/Puub5+vdcr3DW3jbhut7txu9FopN1ub3zc6XTSaDRSVdW25gAAAOzMlhF3%0A+vTpnD17NktLS1lbW8uJEydy9OjRTE1NJUnGxsaSJP39/duaAwAAsDNbRtzhw4dz+PDhm2ajo6MZ%0AHR295drtzgEAANg+b/YNAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEH%0AAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQEBEHAABQ%0AEBEHAABQkIFeL/Bx/+v/XOn1Clt6YKA/v9YY7PUaAADAHrXrIu7H//N/93qFLf1aYzD/479+I319%0Afb1eBQAA2IO8nBIAAKAgIg4AAKAgIg4AAKAgIg4AAKAgIg4AAKAgIg4AAKAgIg4AAKAgO36fuH/6%0Ap3/KP/7jP+YLX/hCfvu3fzutVisLCwuZn59PkoyPj6fVaiXJJ84BAADYnh1H3N///d/nlVdeyb//%0A+79neno6f/qnf5q5ublMTk4mSaanp9NqtVJV1S3zkZERb5YNAACwAzuOuEceeSTnzp3L0tJSvvnN%0Ab6bdbqfZbKZWqyVJhoeH02630+12b5l3Op00m827cw8AAAD2kB1H3MGDB/MP//APuXHjRn7jN34j%0AKysrqdfrmZ2dTZLU6/UsLy9v3P74vOSIGxwc3IhS9pDLa73e4LYG7hvI0NBQr9fgXivgbCbO557k%0AbLKbOZ97zkAhj/md2FHEXbp0Ke+9917+6I/+KEnyk5/8JM8//3xWV1czMTGRbrebmZmZ7Nu3L1VV%0AbTov2crKipeDsitdX7+excXFXq8Bm3I+2a2cTXYz5/Puub5+vdcr3DU7iriqqnLjxo0kSbfbzbVr%0A19JoNNJutzeu6XQ6aTQaqapq0zkAAADbt6OIazab+eY3v5k/+7M/S1VV+e53v5v7778/R48ezdTU%0AVJJkbGwsSdLf37/pHAAAgO3b8e/E/eZv/uYts9HR0YyOjt7xHAAAgO3xZt8AAAAFEXEAAAAFEXEA%0AAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAF%0AEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEA%0AAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFGdjpP/zoo49y8uTJ3LhxI9/4xjfy3HPP%0AZWFhIfPz80mS8fHxtFqtJPnEOQAAANuz44h7/fXXc+zYsTz22GNJkqqqMjc3l8nJySTJ9PR0Wq3W%0ApvORkZH09fXdhfUBAAD2lh1FXFVVuXTp0kbAJUmn00mz2UytVkuSDA8Pp91up9vt3jL/z2sBAADY%0Anh1F3JUrV3Lt2rW88sorWVtby9NPP50vf/nLqdfrmZ2dTZLU6/UsLy9v3P74vOSIGxwc3IhS9pDL%0Aa73e4LYG7hvI0NBQr9fgXivgbCbO557kbLKbOZ97zkAhj/md2FHEDQ4Opl6v56WXXkpVVZmcnMzv%0A/d7vZXV1NRMTE+l2u5mZmcm+fftSVdWm85KtrKx4OSi70vX161lcXOz1GrAp55PdytlkN3M+757r%0A69d7vcJds6OIGxgYyP79+7O0tJQHH3wwAwMDaTQaabfbG9d0Op00Go1UVbXpHAAAgO3b8R82+d73%0Avpef/exnWV1dzZNPPpn7778/R48ezdTUVJJkbGwsSdLf37/pHAAAgO3bccR95StfyR//8R/fNBsd%0AHc3o6Ogt137SHAAAgO3xZt8AAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAF%0AEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEA%0AAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAFEXEAAAAF%0AGfg0/3h9fT0vvvhinn322Rw6dCgLCwuZn59PkoyPj6fVaiXJJ84BAADYnk8VcW+99VYeffTR9PX1%0ApdvtZm5uLpOTk0mS6enptFqtVFV1y3xkZCR9fX2ffnsAAIA9Zscvp7x69WoWFhbyxBNPpNvtpt1u%0Ap9lsplarpVarZXh4OO12O51O55Z5p9O5m/cBAABgz9jxM3FvvvlmDh06lKWlpSTJyspK6vV6Zmdn%0AkyT1ej3Ly8sbtz8+bzabn25zAACAPWhHEbe6upoLFy7k8OHDOXPmTJJkcHAwq6urmZiYSLfbzczM%0ATPbt25eqqjadl2xwcDC1Wq3Xa3CvXV7r9Qa3NXDfQIaGhnq9BvdaAWczcT73JGeT3cz53HMGCnnM%0A78SOIu7ChQtZX1/Pq6++msuXL+fGjRv51V/91bTb7Y1rOp1OGo1GqqradF6ylZUVv9PHrnR9/XoW%0AFxd7vQZsyvlkt3I22c2cz7vn+vr1Xq9w1+wo4h5//PE8/vjjSZIzZ87k6tWr+ZVf+ZUcPXo0U1NT%0ASZKxsbEkSX9//6ZzAAAAtu9T/XXKJHnqqac2bo+OjmZ0dPSWaz5pDgAAwPZ4s28AAICCiDgAAICC%0AiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgA%0AAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICC%0AiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCiDgAAICCDOzkH7322mtpt9upqiovvPBChoeH%0As7CwkPn5+STJ+Ph4Wq1WknziHAAAgO3bUcSdOHEiSfL+++/njTfeyMTERObm5jI5OZkkmZ6eTqvV%0ASlVVt8xHRkbS19d3l9YHAADYW3YUcf/pgQceyMDAQNrtdprNZmq1WpJkeHg47XY73W73lnmn00mz%0A2fz0mwMAAOxBnyri3nnnnTzzzDNZWVlJvV7P7OxskqRer2d5eXnj9sfnIg4AAGBndhxx7777bh56%0A6KE8/PDD+fDDD7O6upqJiYl0u93MzMxk3759qapq03npBgcHN55dZA+5vNbrDW5r4L6BDA0N9XoN%0A7rUCzmbifO5Jzia7mfO55wwU8pjfiR1F3AcffJBz587lueeeS5I0Go202+2Nz3c6nTQajVRVtem8%0AdCsrK36vj13p+vr1LC4u9noN2JTzyW7lbLKbOZ93z/X1671e4a7ZUcT99Kc/zf79+/Pyyy/nl3/5%0Al/ODH/wgR48ezdTUVJJkbGwsSdLf37/pHAAAgJ3ZUcSdPHnyltno6GhGR0fveA4AAMD2ebNvAACA%0Agog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4%0AAACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACA%0Agog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAgog4AACAggzcqy+0sLCQ+fn5JMn4%0A+Hharda9+tIAAACfG/ck4qqqytzcXCYnJ5Mk09PTGRkZSV9f37348gAAAJ8b9+TllJ1OJ81mM7Va%0ALbVaLcPDw+l0OvfiSwMAAHyu3JNn4lZWVlKv1zM7O5skqdfrWV5eTrPZvOXa//ZfHr4XK+3YV794%0An2cQAQCAnunrdrvdz/qLfPjhhzl9+nQmJibS7XYzMzOT3/qt30qj0bjpurfffvuzXgUAAGBX+853%0AvrPl5+/JM3GNRiPtdnvj406nc0vAJbdfFgAAYK+7J8/EJck///M/b/x1yrGxsRw8ePBefFkAAIDP%0AlXsWcQAAAHx63uwbAACgICIOAACgICIOAACgIPfkr1Pezvnz53Pq1KkcOHAgx48f7/U6cJPXXnst%0A7XY7VVXlhRdeyPDwcK9XgiTJ3/zN3+TixYvp7+/PiRMnnE12nfX19bz44ot59tlnc+jQoV6vA0mS%0Av/qrv8qHH36YWq2WX//1X89TTz3V65Vgw0cffZSTJ0/mxo0b+frXv57vf//7m163KyJufX09R44c%0AycWLF3u9CtzixIkTSZL3338/b7zxRn74wx/2eCP4D8eOHUuSXLhwIX/3d3+3cVZht3jrrbfy6KOP%0Apq+vr9erwIa+vr784R/+Yb7yla/0ehW4xeuvv55jx47lscce2/K6XfFyyoMHD2ZwcLDXa8CWHnjg%0AgQwM7Iqfe8BN/uVf/iUPP/xwr9eAm1y9ejULCwt54okn4g9hs9s4k+xGVVXl0qVLtw24ZJc8Ewcl%0AeOedd/LMM8/0eg24yU9+8pNcuXIlf/Inf9LrVeAmb775Zg4dOpSlpaVerwI3eeCBB/KXf/mX+eIX%0Av5jf+Z3fSaPR6PVKkCS5cuVKrl27lldeeSVra2t5+umn8+1vf3vTa3fFM3Gw27377rt56KGHPNvB%0ArvPyyy/n93//93Py5MlerwIbVldXc+HChXzrW9/q9Spwi+effz5TU1M5duxYXn/99V6vAxsGBwdT%0Ar9fz0ksv5cc//nH+9m//NteuXdv02l3zTJyntdmtPvjgg5w7dy7PPfdcr1eBTX35y19OVVW9XgM2%0AXLhwIevr63n11Vdz+fLl3LhxI61WK4888kivV4MN9913X77whS/0eg3YMDAwkP3792dpaSkPPvjg%0Alr/G09fdBfV0+vTpnD17NktLSzlw4IBfzmdX+YM/+IPs378//f39+drXvpbnn3++1ytBkuQv/uIv%0Asry8nIGBgfzgBz9Is9ns9UpwizNnzuTq1av57ne/2+tVIEny6quvZnFxMb/0S7+U3/3d381Xv/rV%0AXq8EG/7t3/4tf/3Xf53V1dU8+eSTn/irPLsi4gAAALgzficOAACgICIOAACgICIOAACgICIOAACg%0AICIOAACgICIOAACgICIOAACgIP8Xja6UxTvUMCMAAAAASUVORK5CYII=">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [29]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Let's recapture the datetime as a different field so we could play with it (it's currently set as the index)</span>
<span class="n">crime</span><span class="p">[</span><span class="s">'date'</span><span class="p">]</span><span class="o">=</span><span class="n">crime</span><span class="o">.</span><span class="n">index</span>

<span class="c">#Check data type - note that its not in any particular format</span>
<span class="n">crime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">dtype</span>

<span class="c">#We can convert this field to datetime easily</span>
<span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">crime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[29]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
cdatetime
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
1/1/06 0:00   2006-01-01
...
1/31/06 23:00   2006-01-31 23:00:00
1/31/06 23:00   2006-01-31 23:00:00
1/31/06 23:00   2006-01-31 23:00:00
1/31/06 23:11   2006-01-31 23:11:00
1/31/06 23:27   2006-01-31 23:27:00
1/31/06 23:31   2006-01-31 23:31:00
1/31/06 23:36   2006-01-31 23:36:00
1/31/06 23:40   2006-01-31 23:40:00
1/31/06 23:41   2006-01-31 23:41:00
1/31/06 23:45   2006-01-31 23:45:00
1/31/06 23:50   2006-01-31 23:50:00
Name: date, Length: 7584, dtype: datetime64[ns]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [31]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="n">crime</span><span class="p">[</span><span class="n">crime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[31]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
Empty DataFrame
Columns: [address, district, beat, grid, crimedescr, ucr_ncic_code, latitude, longitude, date]
Index: []
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [48]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Merge and Concat</span>

<span class="c">#Let's create two simple dataframes and try to merge them</span>
<span class="n">df1</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">score</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
<span class="n">df2</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">)))</span>

<span class="k">print</span> <span class="n">df1</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span> <span class="n">df2</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>

<span class="c">#So df1 and df2 are just a bunch of random integers. df2 is slightly bigger with some overlap to df1.</span>

<span class="c">#Merge performs an inner join so returns only matching indexes, exactly 10 in our case.</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">)</span> <span class="c">#we can make this outer join with how='outer'</span>

<span class="k">print</span> <span class="n">df3</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
             id     score
count  10.00000  10.00000
mean    4.50000   4.80000
std     3.02765   2.20101
min     0.00000   1.00000
25%     2.25000   3.25000
50%     4.50000   5.00000
75%     6.75000   6.00000
max     9.00000   9.00000               id  precision
count  15.000000  15.000000
mean    7.000000  13.133333
std     4.472136   3.758166
min     0.000000   7.000000
25%     3.500000  11.500000
50%     7.000000  13.000000
75%    10.500000  15.500000
max    14.000000  19.000000
   id  score  precision
0   0      3         13
1   1      6         15
2   2      4         11
3   3      6         13
4   4      5         18
5   5      6          8
6   6      5         12
7   7      1          7
8   8      3         17
9   9      9         12

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [49]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#While concat just appends rows (or cols if axis=1)</span>
<span class="n">df4</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">])</span>

<span class="k">print</span> <span class="n">df4</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
    id  precision  score
0    0        NaN      3
1    1        NaN      6
2    2        NaN      4
3    3        NaN      6
4    4        NaN      5
5    5        NaN      6
6    6        NaN      5
7    7        NaN      1
8    8        NaN      3
9    9        NaN      9
0    0         13    NaN
1    1         15    NaN
2    2         11    NaN
3    3         13    NaN
4    4         18    NaN
5    5          8    NaN
6    6         12    NaN
7    7          7    NaN
8    8         17    NaN
9    9         12    NaN
10  10         19    NaN
11  11         15    NaN
12  12         16    NaN
13  13         14    NaN
14  14          7    NaN

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [56]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Column wise concat</span>
<span class="k">print</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">[:</span><span class="mi">10</span><span class="p">][</span><span class="s">'precision'</span><span class="p">]],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c">#We can convert this to an inner join with a join = 'inner' parameter</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
   id  score  precision
0   0      3         13
1   1      6         15
2   2      4         11
3   3      6         13
4   4      5         18
5   5      6          8
6   6      5         12
7   7      1          7
8   8      3         17
9   9      9         12

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [75]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#We can create hierarchical indexes by specifying keys</span>
<span class="n">df2</span><span class="p">[</span><span class="s">'recall'</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
<span class="n">df5</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span><span class="n">df2</span><span class="p">[:</span><span class="mi">10</span><span class="p">]],</span> <span class="n">join</span><span class="o">=</span><span class="s">'inner'</span><span class="p">,</span> <span class="n">keys</span><span class="o">=</span><span class="p">[</span><span class="s">'id1'</span><span class="p">,</span><span class="s">'id2'</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">df5</span> <span class="c">#Hierarchical indexes can be referenced as df5.id2.precision and so on.</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[75]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
   id1         id2                     
    id  score   id  precision    recall
0    0      3    0         13  0.911068
1    1      6    1         15  0.571435
2    2      4    2         11  0.492971
3    3      6    3         13  0.112970
4    4      5    4         18  0.515867
5    5      6    5          8  0.592116
6    6      5    6         12  0.219727
7    7      1    7          7  0.434970
8    8      3    8         17  0.787740
9    9      9    9         12  0.299421
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [152]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Now, let's try to find burglaries in sacramento using the str.contains functions</span>
<span class="n">burglaries</span><span class="o">=</span><span class="n">crime</span><span class="p">[</span><span class="n">crime</span><span class="o">.</span><span class="n">crimedescr</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s">'BURGLARY'</span><span class="p">,</span> <span class="s">'burglary'</span><span class="p">)][:</span><span class="mi">10</span><span class="p">]</span>
<span class="k">print</span> <span class="n">burglaries</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c">#Let's find out how many crimes occurred by weekday</span>
<span class="n">burglaries</span><span class="o">.</span><span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">burglaries</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">burglaries</span><span class="p">[</span><span class="s">'weekday'</span><span class="p">]</span><span class="o">=</span><span class="n">burglaries</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">weekday</span> <span class="c">#capture weekday</span>
<span class="n">burglaries</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'weekday'</span><span class="p">)[</span><span class="s">'district'</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s">'Burglaries occuring by Weekday in Sacramento'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
                         address  district        beat  grid  \
cdatetime                                                      
1/1/06 0:00  2082 EXPEDITION WAY         5  5A          1512   
1/1/06 0:00     3421 AUBURN BLVD         2  2A           508   
1/1/06 0:00        2217 16TH AVE         4  4A           957   
1/1/06 0:00     3421 AUBURN BLVD         2  2A           508   
1/1/06 0:01     5551 REXLEIGH CT         5  5C          1661   

                               crimedescr  ucr_ncic_code   latitude  \
cdatetime                                                             
1/1/06 0:00    459 PC  BURGLARY RESIDENCE           2204  38.473501   
1/1/06 0:00  459 PC  BURGLARY-UNSPECIFIED           2299  38.637448   
1/1/06 0:00      459 PC  BURGLARY VEHICLE           2299  38.537173   
1/1/06 0:00     459 PC  BURGLARY BUSINESS           2203  38.637448   
1/1/06 0:01      459 PC  BURGLARY VEHICLE           2299  38.446592   

              longitude         date  
cdatetime                             
1/1/06 0:00 -121.490186  1/1/06 0:00  
1/1/06 0:00 -121.384613  1/1/06 0:00  
1/1/06 0:00 -121.487577  1/1/06 0:00  
1/1/06 0:00 -121.384613  1/1/06 0:00  
1/1/06 0:01 -121.442378  1/1/06 0:01  

</pre>
</div>
</div>

<div class="output_area">
<div class="prompt"></div>


<div class="output_png output_subarea ">
<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA2wAAAFRCAYAAAAIFy4LAAAABHNCSVQICAgIfAhkiAAAAAlwSFlz%0AAAALEgAACxIB0t1+/AAAIABJREFUeJzt3X9U1HW+x/HXwDAgkCtKMYjUUa9HV0iSzCJ/gLr+iO2W%0AvzBsNQkVi/aWbGu3bNGrxjm2t1tEeM/Vta6rx9ab7s3cfh413e6eWFrrtqwlnLzmpsGo6aAghOB8%0A7x9e50r8mDHQ+bjzfJzjOc73+57v9z3f+XwHXny+M2OzLMsSAAAAAMA4IYFuAAAAAADQPgIbAAAA%0AABiKwAYAAAAAhiKwAQAAAIChCGwAAAAAYCgCGwAAAAAYisAGBJEnn3xSI0aMUHp6usaMGaPs7Gzt%0A27fvqvfxk5/8ROnp6RoyZIiOHTt2RfdVUVGhRx999Iru42/JokWLdPDgwYDs+0qOh+bmZv3whz/U%0AqVOn2qzbvHmzFi9e3G37mjt3rnbs2HFZ97ka50JHruQ50tTUpGeeeUYTJkxQenq6Jk6cGLDHaYLy%0A8nJNmjQp0G0AuMbYA90AgKvHZrNpwYIFeuihhyRJ27dvV0FBgf7rv/7rqvaxefNmSRd+Sb3Shg0b%0AppKSkiu+n78Va9euDXQLV0RYWJji4+N17Ngx9e7du9W6Y8eO6aabburW/dlstm7d3pV0Jc+RF198%0AUdXV1frd736nyMhINTQ0KDIy8orsCwD+VjHDBgQZy7IkSefPn1d9fb0SExO9644ePaqkpKRW9Tk5%0AOXr99ddbLRsyZIg++OADTZ8+XWPGjNFTTz3Vav2WLVs0fvx4jRkzRrm5uZoyZYpefPFFv3t0u91a%0AuXKlfvzjH+vOO+/UrFmz9D//8z+tal566SUtXbpU//Iv/6Jx48ZpzJgxqqqq8q7fvXu30tPTlZaW%0A1uFftF999VVNnjxZ48aN07Jly9TU1NRq/b59+5Sdna2MjAylp6dr1apVfj+Gi1577TXdddddGjt2%0ArObNm9fmcZw7d06lpaW66667vDMQ3531LCsrU3Z2ttLT0zV27Fg9++yz3nXt/cV+4sSJ+uijj7y3%0Ajx49qqFDh6q8vFx33323Ro8e3eb5mDRpktLT05WUlKSPP/641bqL9//www+VlZWlO+64Q48//rh3%0ALElSfX29HnvsMY0ZM0aZmZmaO3euRo8ercOHD1/W8dq1a5emT5+utLQ0FRQU6OzZs97tDx8+XF99%0A9ZW3tqqqSiNHjtS5c+f82na/fv1UU1MjSTp16pQaGxslSTU1Nbrxxhu9db7GRVVVlebMmaOxY8fq%0AvvvuazXuvuvUqVO67777VFpa6l3m8Xj07LPPatSoUcrMzNSrr77a5n7l5eXKy8vT5MmTlZaWpsLC%0AQu/x7o5jIfk+R1566SU9+eSTeuGFFzR58mSNHj1ab7/9tt/bl6SvvvpKqamp3pDWXlhbu3atpk+f%0A7h3/u3btarXen3Nk/PjxeuuttzR37lyNHTtWOTk5rda/9tpruu+++zR+/Hilp6frN7/5TavH+dRT%0AT2n+/Pm666679Je//EWTJ09uM+vY2bjw5xz55S9/qcWLF+vrr79Wenq60tPT9ac//alNn529XgAI%0AUhaAoPGP//iP1m233WaNGzfOSkpKsqZNm2adPHnSu/7IkSPW0KFDW90nJyfHev3111stGzx4sJWd%0AnW0dOXLEsizLqqur8647ePCgddttt1k1NTVWXV2dNWHCBOs///M/rW+//bZNP4MHD7ZcLleb5Y2N%0AjdaHH35oeTwey+PxWIWFhdaiRYta1ZSUlFgjR4601q1bZ1mWZdXX17f7mMvLy62JEye2Wf7WW29Z%0A48aNs44ePWp5PB5r6dKlVlFRUauaUaNGWW+++ab39qWP0x/vvvuuNXHiROvrr7+2LMuyXn/9dWvM%0AmDHW2bNnvTVLly61Hn74YcvtdluWZVkNDQ2tjtVHH31kjRo1yvr444+9y06dOuX9/x//+Mc2j2/i%0AxInWRx995L195MgRa8iQIdaiRYu89+3oeI0bN67Vvi7ef/DgwdbKlSuthoYG68yZM9btt99ulZeX%0Ae2uee+4569FHH7Usy7Lef/9969Zbb7VOnjxpnT9/3o8jdcHgwYOtZcuWWU1NTVZjY6P1wAMPWKtX%0Ar/auf/zxx63S0tJW+1yxYoXf21+6dKm1efNmq6Wlxbr99tu9950zZ473ePkaF3V1ddadd95pbdu2%0AzbIsyyorK7MyMjKsxsZGb82cOXOsHTt2WH/961+tzMxM67e//W2rPjZv3mxNmTLF+uabb6zz589b%0ApaWlbc6FAwcOWF999ZVlWZZ1/Phxa+zYsdZ7773XbcfiUh2dIxfPsZ07d1qWZVnbt2+3xo0bd1nb%0A/tOf/mTdcccdVnFxsfXNN9+0W/OHP/zBe/y2b99ujRgxwvJ4PN71vs4Ry7owbu+++27rs88+syyr%0A7blaXl5unT592rKsC+dUUlKS97WvpKTEGj9+vHXq1Clr0qRJVn5+vlVdXW0NHjzYex9f48Kfc+Ri%0AH+0da8vy7/UCQHBihg0IIjabTbm5uXr//fdVXl6usWPHKj8/Xx6P57K3tXLlSvXr10+SFB0d7V1e%0AVVWlgQMHyul0Kjo6WjfffLNOnz6t8PBwv7cdERGhtLQ02Ww22Ww2TZgwQYcOHWpTd/vtt2vhwoWS%0ApKioqHa3ZV3yF+5Lbdu2TTk5OUpISJDNZtNjjz2mbdu2tarp27evPvroI3355ZdtHqc/XnvtNS1c%0AuFB9+/aVJE2dOlXx8fHau3evpAszidu3b9fq1avVq1cvSVKPHj1aHauXX35ZixYtUmpqqndZTEzM%0AZfUhXXjun3vuOe99OzpeHQkNDVVhYaF69Oih6667ToMGDVJ1dbV3fWVlpUaPHi1JSktLU319vex2%0Au0JCLu/HTH5+vhwOhyIiIvTQQw9p586d3nXTpk3TW2+9JenC8/r2229r+vTpfm/7xhtvlMvl0r59%0A+zRy5Eh9+OGHklrPsPkaF3v27NENN9ygGTNmSJLuuOMODRgwQB988EGrff35z3/WvHnz9NRTT7Xp%0A8Z133tGCBQvUp08fhYSE6JFHHmnT65AhQ7yz37GxsRoxYkSr2ZauHotLdXSO2Gw2TZo0ST/60Y8k%0ASbfeeqt3htJfI0aM0I4dOxQaGqrp06dr9erVOn/+fKuaUaNGKSIiQtKFmd76+nodP35ckn/nyEWP%0AP/64hg4dKqntuTpy5Ej17NlTkjR8+HD17t271ezvnXfeqZiYGDmdTk2cOFHx8fEKCQnR6dOnJfn3%0AetHeOfLd49XRsZZ8v14ACF68hw0IMhd/YYiKitLixYs1adIklZeXKy0t7bK2c/GXn+9KSkrSwYMH%0A9eWXX+q6667TJ598ogcffPCye3zllVe0e/duWZallpaWNr/k2Wy2Dnvwx7Fjx7Ru3Tpt2LDBu8xu%0At+v06dP6wQ9+IElat26dXn31VS1ZskSnT5/Wo48+qr//+7/3ex8ul8sbai9KTEz0Bp0jR46od+/e%0AnT6Oo0ePauDAgZfxyNpns9kuO3B2xm5v/eNj2LBh2rVrl6ZOnar33ntPAwcO7NLzI0k33HBDqw8J%0ASUtL09mzZ3XgwAE1NjYqMjJSycnJfm8vMTFRe/bs0c6dO3XPPffozTff1Mcffyy32624uDhJvsfF%0A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">
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [182]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Let's now read in a different CSV file containing residential/commerical Insurance details from Florida</span>
<span class="n">ins</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'FL_insurance_sample.csv'</span><span class="p">,</span><span class="n">parse_dates</span><span class="o">=</span><span class="s">'True'</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
<span class="n">ins</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s">'county'</span><span class="p">,</span><span class="s">'policyID'</span><span class="p">],</span> <span class="n">drop</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> 
<span class="c">#setting index seperately and retaining the col so we can play with it</span>
<span class="n">ins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[182]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                      policyID statecode       county  eq_site_limit  \
county      policyID                                                   
CLAY COUNTY 119736      119736        FL  CLAY COUNTY       498960.0   
            448094      448094        FL  CLAY COUNTY      1322376.3   
            206893      206893        FL  CLAY COUNTY       190724.4   
            333743      333743        FL  CLAY COUNTY            0.0   
            172534      172534        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            206893        190724.40       190724.4       190724.4   190724.40   
            333743         79520.76            0.0            0.0    79520.76   
            172534        254281.50            0.0       254281.5   254281.50   

                        tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                       
CLAY COUNTY 119736     792148.90                   0              9979.2   
            448094    1438163.57                   0                 0.0   
            206893     192476.78                   0                 0.0   
            333743      86854.48                   0                 0.0   
            172534     246144.49                   0                 0.0   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            206893                     0                   0       30.089579   
            333743                     0                   0       30.063236   
            172534                     0                   0       30.060614   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      Masonry   
            448094         -81.707664  Residential      Masonry   
            206893         -81.700455  Residential         Wood   
            333743         -81.707703  Residential         Wood   
            172534         -81.702675  Residential         Wood   

                      point_granularity  
county      policyID                     
CLAY COUNTY 119736                    1  
            448094                    3  
            206893                    1  
            333743                    3  
            172534                    1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [180]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Stack displays by cols instead of rows</span>
<span class="n">ins</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[180]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
county       policyID                    
CLAY COUNTY  119736    statecode                   FL
                       eq_site_limit           498960
                       hu_site_limit           498960
                       fl_site_limit           498960
                       fr_site_limit           498960
                       tiv_2011                498960
                       tiv_2012              792148.9
                       eq_site_deductible           0
                       hu_site_deductible      9979.2
                       fl_site_deductible           0
...
PINELLAS COUNTY  398149    tiv_2011                 373488.3
                           tiv_2012                 596003.7
                           eq_site_deductible              0
                           hu_site_deductible              0
                           fl_site_deductible              0
                           fr_site_deductible              0
                           point_latitude           28.06444
                           point_longitude         -82.77459
                           line                  Residential
                           construction              Masonry
                           point_granularity               1
Length: 586144, dtype: object
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [194]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#It's easy to create pivot tables. We can also use ins.pivot but cannot specify hierarchical indexes and use</span>
<span class="c">#aggregation functions such as below.</span>
<span class="n">ins</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="s">'county'</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="s">'line'</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="s">'eq_site_limit'</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="nb">sum</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[194]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
line                 Commercial  Residential
county                                      
ALACHUA COUNTY     3.249922e+08   99142554.6
BAKER COUNTY       2.476577e+06     378068.4
BAY COUNTY         5.988847e+08   41356479.6
BRADFORD COUNTY    3.483000e+07    2445573.6
BREVARD COUNTY     2.399631e+08   37744344.9
BROWARD COUNTY     1.639098e+09  125713440.0
CALHOUN COUNTY     0.000000e+00     827662.5
CHARLOTTE COUNTY   1.556845e+08   31873591.8
CITRUS COUNTY      2.686367e+08   27245415.6
CLAY COUNTY        3.324845e+06   13818491.1
COLLIER COUNTY     3.773078e+08   31509111.6
COLUMBIA COUNTY    1.849905e+06    4706864.1
...                         ...          ...
SANTA ROSA COUNTY  1.915291e+08   52968218.4
SARASOTA COUNTY    4.544602e+08   55764873.9
SEMINOLE COUNTY    2.382608e+08   66281730.3
ST  JOHNS COUNTY   2.631974e+08   37636201.8
SUMTER COUNTY      0.000000e+00    6679728.0
SUWANNEE COUNTY    4.354253e+07   13221386.1
TAYLOR COUNTY      2.279104e+07    9770446.8
UNION COUNTY                NaN     810488.7
VOLUSIA COUNTY     1.674162e+08   60949216.8
WAKULLA COUNTY     3.833100e+06    7965052.2
WALTON COUNTY      3.784400e+07   16741737.9
WASHINGTON COUNTY  0.000000e+00    1067338.8

[67 rows x 2 columns]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [195]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Crosstab simply gives the group frequencies</span>
<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">line</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[195]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
construction  Masonry  Reinforced Concrete  Reinforced Masonry  Steel Frame  \
line                                                                          
Commercial          0                 1299                4225          272   
Residential      9257                    0                   0            0   

construction   Wood  
line                 
Commercial        0  
Residential   21581  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [199]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Mapping columns to different values/labels is done through the map function</span>
<span class="n">ins</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">ins</span><span class="p">[</span><span class="s">'lineno'</span><span class="p">]</span><span class="o">=</span><span class="n">ins</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">map</span><span class="p">({</span><span class="s">'Residential'</span><span class="p">:</span><span class="s">'1'</span><span class="p">,</span> <span class="s">'Commercial'</span><span class="p">:</span><span class="s">'2'</span><span class="p">})</span>
<span class="n">ins</span><span class="o">.</span><span class="n">lineno</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[199]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
array(['1', '2'], dtype=object)
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [200]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#We can also simply replace</span>
<span class="n">ins</span><span class="o">.</span><span class="n">lineno</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="s">'1'</span><span class="p">:</span><span class="s">'Res'</span><span class="p">,</span> <span class="s">'2'</span><span class="p">:</span><span class="s">'Comm'</span><span class="p">})</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[200]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
county       policyID
CLAY COUNTY  119736       Res
             448094       Res
             206893       Res
             333743       Res
             172534       Res
             785275       Res
             995932      Comm
             223488       Res
             433512       Res
             142071       Res
...
PINELLAS COUNTY  592170      Res
                 827844      Res
                 876385      Res
                 167630      Res
                 241496      Res
                 780814      Res
                 404309      Res
                 465875      Res
                 791209      Res
                 322627      Res
                 398149      Res
Name: lineno, Length: 36634, dtype: object
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [202]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre> <span class="c">#Creating a design matrix is very simple (DM is basically 1s and 0s for different values of a col represented as multiple</span>
<span class="c">#columns). For instance</span>
<span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[202]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                      Masonry  Reinforced Concrete  Reinforced Masonry  \
county      policyID                                                     
CLAY COUNTY 119736          1                    0                   0   
            448094          1                    0                   0   
            206893          0                    0                   0   
            333743          0                    0                   0   
            172534          0                    0                   0   

                      Steel Frame  Wood  
county      policyID                     
CLAY COUNTY 119736              0     0  
            448094              0     0  
            206893              0     1  
            333743              0     1  
            172534              0     1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [254]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#We can also cut a column into multiple buckets..similar to grouping</span>
<span class="n">ins</span><span class="p">[</span><span class="s">'site_buckets'</span><span class="p">]</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">eq_site_limit</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">100000.0</span><span class="p">,</span> <span class="mf">500000.0</span><span class="p">,</span> <span class="mf">10000000.0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="s">'B1'</span><span class="p">,</span><span class="s">'B2'</span><span class="p">,</span><span class="s">'B3'</span><span class="p">])</span>
<span class="n">ins</span><span class="p">[[</span><span class="s">'eq_site_limit'</span><span class="p">,</span> <span class="s">'site_buckets'</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c">#pd.qcut cuts by quantiles (percentages)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[254]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                      eq_site_limit site_buckets
county      policyID                            
CLAY COUNTY 119736         498960.0           B2
            448094        1322376.3           B3
            206893         190724.4           B2
            333743              0.0           B1
            172534              0.0           B1
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [259]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Sorting by county (asc) and policyID (desc)</span>
<span class="n">ins</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s">'county'</span><span class="p">,</span><span class="s">'policyID'</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[259]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                         policyID statecode          county  eq_site_limit  \
county         policyID                                                      
ALACHUA COUNTY 999597      999597        FL  ALACHUA COUNTY              0   
               999293      999293        FL  ALACHUA COUNTY           2700   
               998177      998177        FL  ALACHUA COUNTY            450   
               997366      997366        FL  ALACHUA COUNTY              0   
               996781      996781        FL  ALACHUA COUNTY            810   

                         hu_site_limit  fl_site_limit  fr_site_limit  \
county         policyID                                                
ALACHUA COUNTY 999597       3130306.73              0              0   
               999293          2700.00           2700           2700   
               998177           450.00            450            450   
               997366        107966.70              0              0   
               996781           810.00            810            810   

                           tiv_2011    tiv_2012  eq_site_deductible  \
county         policyID                                               
ALACHUA COUNTY 999597    3130306.73  3891146.56                   0   
               999293       2700.00     3691.70                   0   
               998177        450.00      542.40                   0   
               997366     107966.70   137551.08                   0   
               996781        810.00      735.35                   0   

                         hu_site_deductible  fl_site_deductible  \
county         policyID                                           
ALACHUA COUNTY 999597                   0.0                   0   
               999293                  54.0                   0   
               998177                   9.0                   0   
               997366                   0.0                   0   
               996781                  16.2                   0   

                         fr_site_deductible  point_latitude  point_longitude  \
county         policyID                                                        
ALACHUA COUNTY 999597                     0       29.621651       -82.378632   
               999293                     0       29.669180       -82.308040   
               998177                     0       29.672756       -82.439331   
               997366                     0       29.682240       -82.387540   
               996781                     0       29.669120       -82.341230   

                                line        construction  point_granularity  \
county         policyID                                                       
ALACHUA COUNTY 999597     Commercial  Reinforced Masonry                  1   
               999293    Residential                Wood                  1   
               998177    Residential                Wood                  1   
               997366    Residential                Wood                  1   
               996781    Residential                Wood                  3   

                        lineno site_buckets  
county         policyID                      
ALACHUA COUNTY 999597        2           B1  
               999293        1           B1  
               998177        1           B1  
               997366        1           B1  
               996781        1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [266]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Random Sort - permutations</span>
<span class="n">sort</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">permutation</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ins</span><span class="p">))</span>
<span class="n">ins</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="n">sort</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[266]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                            policyID statecode             county  \
county            policyID                                          
ORANGE COUNTY     622266      622266        FL      ORANGE COUNTY   
DUVAL COUNTY      158604      158604        FL       DUVAL COUNTY   
MIAMI DADE COUNTY 154173      154173        FL  MIAMI DADE COUNTY   
ST  JOHNS COUNTY  312502      312502        FL   ST  JOHNS COUNTY   
DUVAL COUNTY      394483      394483        FL       DUVAL COUNTY   

                            eq_site_limit  hu_site_limit  fl_site_limit  \
county            policyID                                                
ORANGE COUNTY     622266                0   4.194000e+08              0   
DUVAL COUNTY      158604                0   1.411931e+05              0   
MIAMI DADE COUNTY 154173                0   5.553381e+05              0   
ST  JOHNS COUNTY  312502            18315   1.831500e+04          18315   
DUVAL COUNTY      394483                0   5.742139e+05              0   

                            fr_site_limit      tiv_2011      tiv_2012  \
county            policyID                                              
ORANGE COUNTY     622266                0  4.194000e+08  3.960000e+08   
DUVAL COUNTY      158604                0  1.411931e+05  2.208260e+05   
MIAMI DADE COUNTY 154173                0  5.553381e+05  8.225912e+05   
ST  JOHNS COUNTY  312502            18315  1.831500e+04  2.250855e+04   
DUVAL COUNTY      394483                0  5.742139e+05  8.161187e+05   

                            eq_site_deductible  hu_site_deductible  \
county            policyID                                           
ORANGE COUNTY     622266                     0                 0.0   
DUVAL COUNTY      158604                     0                 0.0   
MIAMI DADE COUNTY 154173                     0                 0.0   
ST  JOHNS COUNTY  312502                     0               366.3   
DUVAL COUNTY      394483                     0                 0.0   

                            fl_site_deductible  fr_site_deductible  \
county            policyID                                           
ORANGE COUNTY     622266                     0                   0   
DUVAL COUNTY      158604                     0                   0   
MIAMI DADE COUNTY 154173                     0                   0   
ST  JOHNS COUNTY  312502                     0                   0   
DUVAL COUNTY      394483                     0                   0   

                            point_latitude  point_longitude         line  \
county            policyID                                                 
ORANGE COUNTY     622266         28.377000       -81.558700   Commercial   
DUVAL COUNTY      158604         30.246492       -81.764511  Residential   
MIAMI DADE COUNTY 154173         25.754580       -80.296220  Residential   
ST  JOHNS COUNTY  312502         30.117205       -81.604431  Residential   
DUVAL COUNTY      394483         30.158780       -81.598960  Residential   

                           construction  point_granularity lineno site_buckets  
county            policyID                                                      
ORANGE COUNTY     622266    Steel Frame                  4      2           B1  
DUVAL COUNTY      158604           Wood                  1      1           B1  
MIAMI DADE COUNTY 154173        Masonry                  3      1           B1  
ST  JOHNS COUNTY  312502           Wood                  1      1           B1  
DUVAL COUNTY      394483        Masonry                  1      1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [298]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Group By and it's relatives - Split Apply Combine</span>

<span class="c">#Let's convert Policy ID to string first so its not included in any numerical operations</span>
<span class="n">ins</span><span class="o">.</span><span class="n">policyID</span><span class="o">=</span><span class="n">ins</span><span class="o">.</span><span class="n">policyID</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s">'str'</span><span class="p">)</span>

<span class="c">#Group By Construction type and sum quantities (aggregate)</span>
<span class="n">ins</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>

<span class="c">#Convenience function available for common agg type</span>
<span class="n">ins</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[298]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                       eq_site_limit  hu_site_limit    fl_site_limit  \
construction                                                           
Masonry                193878.508772   8.496695e+05    145441.406633   
Reinforced Concrete   4015452.193995   1.601223e+07   3313604.618938   
Reinforced Masonry     712295.683030   3.709712e+06    652968.647361   
Steel Frame          59778529.411765   1.090228e+08  57188051.470588   
Wood                    23953.954233   9.261205e+04     17715.800510   

                       fr_site_limit      tiv_2011      tiv_2012  \
construction                                                       
Masonry                270188.807011  8.608683e+05  1.041986e+06   
Reinforced Concrete   6748500.692841  1.665118e+07  2.021243e+07   
Reinforced Masonry    1526479.014249  3.824857e+06  4.621373e+06   
Steel Frame          65920036.764706  1.169841e+08  1.334925e+08   
Wood                    30746.678231  9.371507e+04  1.134930e+05   

                     eq_site_deductible  hu_site_deductible  \
construction                                                  
Masonry                      102.921130         3607.542811   
Reinforced Concrete         4659.850115        55441.015012   
Reinforced Masonry          1011.101538        17593.810296   
Steel Frame                62130.272426       252545.330515   
Wood                          16.356888          435.125583   

                     fl_site_deductible  fr_site_deductible  point_latitude  \
construction                                                                  
Masonry                      218.946851            3.402830       27.912242   
Reinforced Concrete          346.420323            0.000000       27.724533   
Reinforced Masonry           762.449964          213.017751       27.691648   
Steel Frame                 3308.833456            0.000000       27.509396   
Wood                          20.952973            1.793244       28.269267   

                     point_longitude  point_granularity  
construction                                             
Masonry                   -81.718078           1.516474  
Reinforced Concrete       -81.567918           1.501925  
Reinforced Masonry        -81.503285           1.479527  
Steel Frame               -81.437564           1.628676  
Wood                      -82.087569           1.734396  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [299]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Change labels as necessary to indicate aggregation</span>
<span class="n">ins</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">add_prefix</span><span class="p">(</span><span class="s">'avg_'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[299]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     avg_eq_site_limit  avg_hu_site_limit  avg_fl_site_limit  \
construction                                                                   
Masonry                  193878.508772       8.496695e+05      145441.406633   
Reinforced Concrete     4015452.193995       1.601223e+07     3313604.618938   
Reinforced Masonry       712295.683030       3.709712e+06      652968.647361   
Steel Frame            59778529.411765       1.090228e+08    57188051.470588   
Wood                      23953.954233       9.261205e+04       17715.800510   

                     avg_fr_site_limit  avg_tiv_2011  avg_tiv_2012  \
construction                                                         
Masonry                  270188.807011  8.608683e+05  1.041986e+06   
Reinforced Concrete     6748500.692841  1.665118e+07  2.021243e+07   
Reinforced Masonry      1526479.014249  3.824857e+06  4.621373e+06   
Steel Frame            65920036.764706  1.169841e+08  1.334925e+08   
Wood                      30746.678231  9.371507e+04  1.134930e+05   

                     avg_eq_site_deductible  avg_hu_site_deductible  \
construction                                                          
Masonry                          102.921130             3607.542811   
Reinforced Concrete             4659.850115            55441.015012   
Reinforced Masonry              1011.101538            17593.810296   
Steel Frame                    62130.272426           252545.330515   
Wood                              16.356888              435.125583   

                     avg_fl_site_deductible  avg_fr_site_deductible  \
construction                                                          
Masonry                          218.946851                3.402830   
Reinforced Concrete              346.420323                0.000000   
Reinforced Masonry               762.449964              213.017751   
Steel Frame                     3308.833456                0.000000   
Wood                              20.952973                1.793244   

                     avg_point_latitude  avg_point_longitude  \
construction                                                   
Masonry                       27.912242           -81.718078   
Reinforced Concrete           27.724533           -81.567918   
Reinforced Masonry            27.691648           -81.503285   
Steel Frame                   27.509396           -81.437564   
Wood                          28.269267           -82.087569   

                     avg_point_granularity  
construction                                
Masonry                           1.516474  
Reinforced Concrete               1.501925  
Reinforced Masonry                1.479527  
Steel Frame                       1.628676  
Wood                              1.734396  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [301]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#We can also define custom aggregation</span>
<span class="n">ins</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="p">)</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">-</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">/</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">())</span><span class="o">.</span><span class="n">add_suffix</span><span class="p">(</span><span class="s">'_norm'</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[301]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                      eq_site_limit_norm  hu_site_limit_norm  \
county      policyID                                           
CLAY COUNTY 119736         498959.506785       498957.883794   
            448094        1322375.806785      1322374.183794   
            206893         190724.031858       190723.410099   
            333743             -0.368142        79519.770099   
            172534             -0.368142       254280.510099   

                      fl_site_limit_norm  fr_site_limit_norm   tiv_2011_norm  \
county      policyID                                                           
CLAY COUNTY 119736         498959.597407        498959.41114   498957.797895   
            448094        1322375.897407       1322375.71114  1322374.097895   
            206893         190724.075007        190723.94993   190723.398041   
            333743             -0.324993            -0.45007    79519.758041   
            172534             -0.324993        254281.04993   254280.498041   

                       tiv_2012_norm  eq_site_deductible_norm  \
county      policyID                                            
CLAY COUNTY 119736     792146.947494                -0.060878   
            448094    1438161.617494                -0.060878   
            206893     192475.825423                -0.047723   
            333743      86853.525423                -0.047723   
            172534     246143.535423                -0.047723   

                      hu_site_deductible_norm  fl_site_deductible_norm  \
county      policyID                                                     
CLAY COUNTY 119736                9978.918554                -0.026253   
            448094                  -0.281446                -0.026253   
            206893                  -0.193938                -0.032017   
            333743                  -0.193938                -0.032017   
            172534                  -0.193938                -0.032017   

                      fr_site_deductible_norm  point_latitude_norm  \
county      policyID                                                 
CLAY COUNTY 119736                  -0.028769            12.545728   
            448094                  -0.028769            12.507403   
            206893                  -0.033160            13.092729   
            333743                  -0.033160            13.066386   
            172534                  -0.033160            13.063764   

                      point_longitude_norm  point_granularity_norm  
county      policyID                                                
CLAY COUNTY 119736              -29.815643               -0.536889  
            448094              -29.811530                1.463111  
            206893              -39.692517               -0.544931  
            333743              -39.699765                1.455069  
            172534              -39.694737               -0.544931  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [317]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#InList</span>
<span class="n">ins</span><span class="p">[</span><span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s">'Wood'</span><span class="p">,</span><span class="s">'Masonry'</span><span class="p">])]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[317]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyID statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY       498960.0   
            448094     448094        FL  CLAY COUNTY      1322376.3   
            206893     206893        FL  CLAY COUNTY       190724.4   
            333743     333743        FL  CLAY COUNTY            0.0   
            172534     172534        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            206893        190724.40       190724.4       190724.4   190724.40   
            333743         79520.76            0.0            0.0    79520.76   
            172534        254281.50            0.0       254281.5   254281.50   

                        tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                       
CLAY COUNTY 119736     792148.90                   0              9979.2   
            448094    1438163.57                   0                 0.0   
            206893     192476.78                   0                 0.0   
            333743      86854.48                   0                 0.0   
            172534     246144.49                   0                 0.0   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            206893                     0                   0       30.089579   
            333743                     0                   0       30.063236   
            172534                     0                   0       30.060614   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      Masonry   
            448094         -81.707664  Residential      Masonry   
            206893         -81.700455  Residential         Wood   
            333743         -81.707703  Residential         Wood   
            172534         -81.702675  Residential         Wood   

                      point_granularity lineno site_buckets  
county      policyID                                         
CLAY COUNTY 119736                    1      1           B2  
            448094                    3      1           B3  
            206893                    1      1           B2  
            333743                    3      1           B1  
            172534                    1      1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [319]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Simple column renaming</span>
<span class="n">ins</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">{</span><span class="s">'eq_site_deductible'</span><span class="p">:</span><span class="s">'eq_site_deductible'</span><span class="p">})</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[319]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyID statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY       498960.0   
            448094     448094        FL  CLAY COUNTY      1322376.3   
            206893     206893        FL  CLAY COUNTY       190724.4   
            333743     333743        FL  CLAY COUNTY            0.0   
            172534     172534        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            206893        190724.40       190724.4       190724.4   190724.40   
            333743         79520.76            0.0            0.0    79520.76   
            172534        254281.50            0.0       254281.5   254281.50   

                        tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                       
CLAY COUNTY 119736     792148.90                   0              9979.2   
            448094    1438163.57                   0                 0.0   
            206893     192476.78                   0                 0.0   
            333743      86854.48                   0                 0.0   
            172534     246144.49                   0                 0.0   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            206893                     0                   0       30.089579   
            333743                     0                   0       30.063236   
            172534                     0                   0       30.060614   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      Masonry   
            448094         -81.707664  Residential      Masonry   
            206893         -81.700455  Residential         Wood   
            333743         -81.707703  Residential         Wood   
            172534         -81.702675  Residential         Wood   

                      point_granularity lineno site_buckets  
county      policyID                                         
CLAY COUNTY 119736                    1      1           B2  
            448094                    3      1           B3  
            206893                    1      1           B2  
            333743                    3      1           B1  
            172534                    1      1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [322]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Formula renaming</span>
<span class="n">ins</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">' '</span><span class="p">,</span><span class="s">''</span><span class="p">),</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[322]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyID statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY       498960.0   
            448094     448094        FL  CLAY COUNTY      1322376.3   
            206893     206893        FL  CLAY COUNTY       190724.4   
            333743     333743        FL  CLAY COUNTY            0.0   
            172534     172534        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            206893        190724.40       190724.4       190724.4   190724.40   
            333743         79520.76            0.0            0.0    79520.76   
            172534        254281.50            0.0       254281.5   254281.50   

                        tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                       
CLAY COUNTY 119736     792148.90                   0              9979.2   
            448094    1438163.57                   0                 0.0   
            206893     192476.78                   0                 0.0   
            333743      86854.48                   0                 0.0   
            172534     246144.49                   0                 0.0   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            206893                     0                   0       30.089579   
            333743                     0                   0       30.063236   
            172534                     0                   0       30.060614   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      Masonry   
            448094         -81.707664  Residential      Masonry   
            206893         -81.700455  Residential         Wood   
            333743         -81.707703  Residential         Wood   
            172534         -81.702675  Residential         Wood   

                      point_granularity lineno site_buckets  
county      policyID                                         
CLAY COUNTY 119736                    1      1           B2  
            448094                    3      1           B3  
            206893                    1      1           B2  
            333743                    3      1           B1  
            172534                    1      1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [323]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#lower-case all DataFrame column names</span>
<span class="n">ins</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">ins</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [332]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Lower-case everything in a DataFrame column</span>
<span class="n">ins</span><span class="o">.</span><span class="n">construction</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
<span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[332]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
county       policyID
CLAY COUNTY  119736      masonry
             448094      masonry
             206893         wood
             333743         wood
             172534         wood
Name: construction, dtype: object
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [336]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Sort dataframe by multiple columns</span>
<span class="n">ins</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">sort</span><span class="p">([</span><span class="s">'construction'</span><span class="p">,</span><span class="s">'line'</span><span class="p">],</span><span class="n">ascending</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ins</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[336]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyid statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY       498960.0   
            448094     448094        FL  CLAY COUNTY      1322376.3   
            785275     785275        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            785275        515035.62            0.0            0.0   515035.62   

                        tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                       
CLAY COUNTY 119736     792148.90                   0              9979.2   
            448094    1438163.57                   0                 0.0   
            785275     884419.17                   0                 0.0   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            785275                     0                   0       30.063236   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      masonry   
            448094         -81.707664  Residential      masonry   
            785275         -81.707703  Residential      masonry   

                      point_granularity lineno site_buckets  
county      policyID                                         
CLAY COUNTY 119736                    1      1           B2  
            448094                    3      1           B3  
            785275                    3      1           B1  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [341]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#select from DataFrame using multiple keys of a hierarchical index</span>
<span class="n">ins</span><span class="o">.</span><span class="n">xs</span><span class="p">((</span><span class="s">'CLAY COUNTY'</span><span class="p">,</span> <span class="mi">119736</span><span class="p">),</span> <span class="n">level</span><span class="o">=</span><span class="p">(</span><span class="s">'county'</span><span class="p">,</span> <span class="s">'policyID'</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[341]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyid statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY         498960   

                      hu_site_limit  fl_site_limit  fr_site_limit  tiv_2011  \
county      policyID                                                          
CLAY COUNTY 119736           498960         498960         498960    498960   

                      tiv_2012  eq_site_deductible  hu_site_deductible  \
county      policyID                                                     
CLAY COUNTY 119736    792148.9                   0              9979.2   

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      masonry   

                      point_granularity lineno site_buckets  
county      policyID                                         
CLAY COUNTY 119736                    1      1           B2  
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In []:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Change all NaNs to None - one of the methods of handling NULL, there are several</span>
<span class="n">ins</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">ins</span><span class="p">)),</span> <span class="bp">None</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [343]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Slice values in a DataFrame column (aka Series)</span>
<span class="n">ins</span><span class="o">.</span><span class="n">line</span><span class="o">.</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[343]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
county       policyID
CLAY COUNTY  119736      Re
             448094      Re
             785275      Re
Name: line, dtype: object
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [344]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Get quick count of rows in a DataFrame</span>
<span class="nb">len</span><span class="p">(</span><span class="n">ins</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[344]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
36634
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [347]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#change data type of DataFrame column</span>
<span class="n">ins</span><span class="o">.</span><span class="n">construction</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">construction</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [348]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c"># Get rid of non-numeric values throughout a DataFrame:</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">ins</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
  <span class="n">ins</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">ins</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'[^0-9]+.-'</span><span class="p">,</span> <span class="s">''</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [350]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Clean up missing values in multiple DataFrame columns</span>
<span class="n">ins</span> <span class="o">=</span> <span class="n">ins</span><span class="o">.</span><span class="n">fillna</span><span class="p">({</span>
    <span class="s">'line'</span><span class="p">:</span> <span class="s">'missing'</span><span class="p">,</span>
    <span class="s">'construction'</span><span class="p">:</span> <span class="s">'missing'</span><span class="p">,</span>
    <span class="s">'eq_site_limit'</span><span class="p">:</span> <span class="s">'0.0'</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [353]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Doing calculations with DataFrame columns that have missing values</span>
<span class="c">#In example below, swap in 0 for df['col1'] cells that contain null</span>
<span class="n">ins</span><span class="p">[</span><span class="s">'eq_new_limit'</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">ins</span><span class="p">[</span><span class="s">'eq_site_limit'</span><span class="p">]),</span><span class="mi">0</span><span class="p">,</span><span class="n">ins</span><span class="p">[</span><span class="s">'eq_site_limit'</span><span class="p">])</span> <span class="o">+</span> <span class="n">ins</span><span class="p">[</span><span class="s">'fr_site_limit'</span><span class="p">]</span>
<span class="n">ins</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[353]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
                     policyid statecode       county  eq_site_limit  \
county      policyID                                                  
CLAY COUNTY 119736     119736        FL  CLAY COUNTY       498960.0   
            448094     448094        FL  CLAY COUNTY      1322376.3   
            785275     785275        FL  CLAY COUNTY            0.0   

                      hu_site_limit  fl_site_limit  fr_site_limit    tiv_2011  \
county      policyID                                                            
CLAY COUNTY 119736        498960.00       498960.0       498960.0   498960.00   
            448094       1322376.30      1322376.3      1322376.3  1322376.30   
            785275        515035.62            0.0            0.0   515035.62   

                        tiv_2012  eq_site_deductible         ...          \
county      policyID                                         ...           
CLAY COUNTY 119736     792148.90                   0         ...           
            448094    1438163.57                   0         ...           
            785275     884419.17                   0         ...           

                      fl_site_deductible  fr_site_deductible  point_latitude  \
county      policyID                                                           
CLAY COUNTY 119736                     0                   0       30.102261   
            448094                     0                   0       30.063936   
            785275                     0                   0       30.063236   

                      point_longitude         line construction  \
county      policyID                                              
CLAY COUNTY 119736         -81.711777  Residential      masonry   
            448094         -81.707664  Residential      masonry   
            785275         -81.707703  Residential      masonry   

                     point_granularity  lineno site_buckets eq_new_limit  
county      policyID                                                      
CLAY COUNTY 119736                   1       1           B2     997920.0  
            448094                   3       1           B3    2644752.6  
            785275                   3       1           B1          0.0  

[3 rows x 21 columns]
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">
In [400]:
</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight"><pre><span class="c">#Delete a column, Copy a DF</span>
<span class="n">ins1</span><span class="o">=</span><span class="n">ins</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">del</span> <span class="n">ins1</span><span class="p">[</span><span class="s">'policyid'</span><span class="p">],</span> <span class="n">ins1</span><span class="p">[</span><span class="s">'county'</span><span class="p">]</span>

<span class="c">#Reset indexes, that is get back hierarchical indexes as columns</span>
<span class="n">ins1</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">ins1</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">
    Out[400]:</div>


<div class="output_text output_subarea output_pyout">
<pre>
        county  policyID statecode  eq_site_limit  hu_site_limit  \
0  CLAY COUNTY    119736        FL       498960.0      498960.00   
1  CLAY COUNTY    448094        FL      1322376.3     1322376.30   
2  CLAY COUNTY    785275        FL            0.0      515035.62   

   fl_site_limit  fr_site_limit    tiv_2011    tiv_2012  eq_site_deductible  \
0       498960.0       498960.0   498960.00   792148.90                   0   
1      1322376.3      1322376.3  1322376.30  1438163.57                   0   
2            0.0            0.0   515035.62   884419.17                   0   

          ...          fl_site_deductible  fr_site_deductible  point_latitude  \
0         ...                           0                   0       30.102261   
1         ...                           0                   0       30.063936   
2         ...                           0                   0       30.063236   

   point_longitude         line construction point_granularity  lineno  \
0       -81.711777  Residential      masonry                 1       1   
1       -81.707664  Residential      masonry                 3       1   
2       -81.707703  Residential      masonry                 3       1   

  site_buckets eq_new_limit  
0           B2     997920.0  
1           B3    2644752.6  
2           B1          0.0  

[3 rows x 21 columns]
</pre>
</div>

</div>

</div>
</div>

</div>
    </div>
  </div>

    </div>
<br><p><i>Share more, Learn more!</i></p>
<br>
<span class="st_twitter_hcount" displaytext="Tweet"></span>
<span class="st_facebook_hcount" displaytext="Facebook"></span>
<span class="st_linkedin_hcount" displaytext="LinkedIn"></span>
<span class="st_pinterest_hcount" displaytext="Pinterest"></span>
<span class="st_googleplus_hcount" displaytext="Google +"></span>
<span class="st_email_hcount" displaytext="Email"></span>
<br><br><br>
    <aside class="postpromonav">
    <nav>
            <ul itemprop="keywords" class="tags">
           <li><a class="tag p-category" href="../categories/data-munging.html" rel="tag">data munging</a></li>
           <li><a class="tag p-category" href="../categories/pandas.html" rel="tag">pandas</a></li>
           <li><a class="tag p-category" href="../categories/python.html" rel="tag">python</a></li>
           <li><a class="tag p-category" href="../categories/scikit-learn.html" rel="tag">scikit-learn</a></li>
        </ul>

            <ul class="pager">
            <li class="previous">
                <a href="pca-sklearn.html" rel="prev" title="Facial Image Compression and Reconstruction with PCA">Previous post</a>
            </li>
            <li class="next">
                <a href="svm-sklearn.html" rel="next" title="Recognizing Hand Written Digits (UCI ML Repo) with Support Vector Machines (SVM)">Next post</a>
            </li>
        </ul>

    </nav>
    </aside>
        <section class="comments">
        <h2>Comments</h2>
                        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="shankarmsy",
            disqus_url="https://shankarmsy.github.io/posts/munging-pandas.html",
        disqus_title="Data Munging with Pandas (Advanced)",
        disqus_identifier="cache/posts/munging-pandas.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="//disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section>
</article>
               <script>var disqus_shortname="shankarmsy";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


        </div>
        <!--End of body content-->

        <footer>
            Contents © 2015         <a href="mailto:Shankar.Muthuswamy@gmail.com">Shankar Muthuswamy</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
    </div>
</div>

            <script src="../assets/js/all-nocdn.js"></script>
    

    <script>jQuery("a.image-reference,!.islink").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    <!-- fancy dates -->
    <script>
    moment.locale("");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script>
    <!-- end fancy dates -->

<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="../assets/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "dfc16d6b-dc4e-4b0f-ab93-b400d1d8cdde", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>


</body>
</html>
